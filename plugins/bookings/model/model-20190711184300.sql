/*
ts:2019-07-11 18:43:00
*/

UPDATE `plugin_reports_reports` SET `custom_report_rules`='$(\"#report_table tbody > tr\").each(function() {\r\n    var tr = this;\r\n    var bookingId = null;\r\n    var $timeslotStatuses = $(tr).find(\"[name*=timeslot_status]\");\r\n    var transactions = $(tr).find(\"var.transactions\");\r\n\r\n    $timeslotStatuses.each(function () {\r\n		console.log($(this).data(\"attending\"));\r\n		if ($(this).data(\"attending\") == \"1\" || $(this).data(\"payg_apply_fees_when_absent\") == 1){\r\n			var val = this.value;\r\n			var select = \'\';\r\n			bookingId = /timeslot_status\\[(\\d+)\\]\\[(\\d+)\\]/.exec(this.name)[1];\r\n				select =\r\n					//(val != \'\' ? val : \'Absent\') +\r\n					\'<select name=\"\' + this.name + \'\" style=\"width:100%;min-width:80px;height:1.5em;\">\' +\r\n					\'<option value=\"Present,Paid\" \' + (val.indexOf(\'Present\') != -1 && val.indexOf(\'Paid\') != -1 ? \'selected=\"selected\"\' : \'\') + \'>Present + Paid<\\/option>\' +\r\n					\'<option value=\"Present\" \' + (val.indexOf(\'Present\') != -1 && val.indexOf(\'Paid\') == -1 ? \'selected=\"selected\"\' : \'\') + \'>Present + Unpaid<\\/option>\';\r\n          if ($(this).data(\"payg_apply_fees_when_absent\") == 1) {\r\n              select += \'<option value=\"Paid\" \' + (val == \'Paid\' ? \'selected=\"selected\"\' : \'\') + \'>Absent<\\/option>\';\r\n              select += \'<option value=\"\" \' + (val == \'\' ? \'selected=\"selected\"\' : \'\') + \'>Absent + Unpaid<\\/option>\';\r\n          } else {\r\n					    select += \'<option value=\"\" \' + (val == \'\' ? \'selected=\"selected\"\' : \'\') + \'>Absent<\\/option>\';\r\n          }\r\n					select += \'<option value=\"Late,Paid\" \' + (val.indexOf(\'Late\') != -1 && val.indexOf(\'Paid\') != -1 ? \'selected=\"selected\"\' : \'\') + \'>Late + Paid<\\/option>\' +\r\n					\'<option value=\"Late\" \' + (val.indexOf(\'Late\') != -1 && val.indexOf(\'Paid\') == -1 ? \'selected=\"selected\"\' : \'\') + \'>Late + Unpaid<\\/option>\' +\r\n					\'<option value=\"Early Departures,Paid\" \' + (val.indexOf(\'Early Departures\') != -1 && val.indexOf(\'Paid\') != -1 ? \'selected=\"selected\"\' : \'\') + \'>Early Departures + Paid<\\/option>\' +\r\n					\'<option value=\"Early Departures\" \' + (val.indexOf(\'Early Departures\') != -1 && val.indexOf(\'Paid\') == -1 ? \'selected=\"selected\"\' : \'\') + \'>Early Departures + Unpaid<\\/option>\'\r\n				\'<\\/option>\';\r\n			$(this).replaceWith(select);\r\n		} else {\r\n			$(this).replaceWith(\"Not Attending\");\r\n		}\r\n    });\r\n\r\n    var tselect = \'\';\r\n    if (transactions.length > 0 && transactions.html() != \'\') {\r\n        var transactionsData = transactions.html();\r\n        transactionsData = transactionsData.split(\'||\');\r\n        var defaultTransaction = -1;\r\n        for (var j = 0; j < transactionsData.length; ++j) {\r\n            transactionsData[j] = transactionsData[j].split(\'@@\');\r\n            if (transactionsData[j][1] == \'Booking - PAYG\') {\r\n                defaultTransaction = j;\r\n            }\r\n        }\r\n        tselect = \'<select name=\"transaction[\' + bookingId + \']\" style=\"width:100%;min-width:80px;height:1.5em;\">\';\r\n        for (var j = 0; j < transactionsData.length; ++j) {\r\n            tselect += \'<option value=\"\' + transactionsData[j][0] + \'\">\' + transactionsData[j][0] + \' \' + transactionsData[j][1] + \' \' + transactionsData[j][2] + \'</option>\';\r\n        }\r\n        tselect += \'</select>\';\r\n    }\r\n    transactions.replaceWith(tselect);\r\n});\r\n' WHERE `name` = 'Master Roll Call';
