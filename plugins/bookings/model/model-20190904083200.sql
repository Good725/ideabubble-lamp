/*
ts: 2019-09-04 08:32:00
*/

INSERT INTO `plugin_reports_reports` (`publish`, `delete`, `name`, `sql`, `report_type`, `autoload`) VALUES (1, 0, 'Course subscriptions', 'select \r\n		bookings.booking_id as `Booking ID`,\r\n		pgws.paymentgw as `Payment Gateway`,\r\n		concat(\'**** **** **** \', cards.last_4) as `Card Number`,\r\n		students.id as `Student ID`,\r\n		concat_ws(\' \', students.first_name, students.last_name) as `Student`,\r\n		cardowners.id as `Card Owner ID`,\r\n		concat_ws(\' \', cardowners.first_name, cardowners.last_name) as `Card Owner`,\r\n		courses.title as `Course`,\r\n		schedules.`name` as `Schedule`\r\n	from plugin_ib_educate_bookings bookings\r\n		inner join plugin_ib_educate_booking_has_schedules has_schedules on bookings.booking_id = has_schedules.id\r\n		inner join plugin_courses_schedules schedules on has_schedules.schedule_id = schedules.id\r\n		inner join plugin_courses_courses courses on schedules.course_id = courses.id\r\n		inner join plugin_ib_educate_bookings_has_card has_card on bookings.booking_id = has_card.booking_id\r\n		inner join plugin_contacts3_has_paymentgw_has_card cards on has_card.card_id = cards.id\r\n		inner join plugin_contacts3_has_paymentgw pgws on cards.has_paymentgw_id = pgws.id\r\n		inner join plugin_contacts3_contacts students on bookings.contact_id = students.id\r\n		inner join plugin_contacts3_contacts cardowners on pgws.contact_id = cardowners.id\r\n	where cards.deleted = 0 and bookings.`delete` = 0 and bookings.booking_status <> 3 and has_schedules.deleted = 0 and has_schedules.booking_status <> 3\r\n	order by students.first_name, students.last_name;\r\n', 'sql', '1');
