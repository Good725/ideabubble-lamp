/*
ts:2017-10-24 15:15:00
*/

UPDATE `plugin_reports_reports` SET `sql`='select\r\n		stu.id as `Student ID`,\r\n		CONCAT_WS(\' \', par.title, par.first_name, par.last_name) as `Parent Name`,\r\n		CONCAT_WS(\' \', stu.title,stu.first_name, stu.last_name) as `Student Name`,\r\n		CONCAT_WS(\' \', par.address1, par.address2) as `Address`,\r\n		par.mobile as `Mobile`,\r\n		par.phone as `Phone`,\r\n		par.email as `Email`,\r\n		b.id as `Booking ID`,\r\n		t.total as `Total Transaction`,\r\n		o.outstanding as `Outstanding Balance`,\r\n		hs.`status` as `Booking Status`\r\n	from plugin_courses_bookings b\r\n		inner join plugin_contacts_contact stu on b.student_id = stu.id\r\n		left join plugin_family_members m on stu.id = m.contact_id\r\n		left join plugin_family_families f on m.family_id = f.id\r\n		left join plugin_contacts_contact par on f.primary_contact_id = par.id\r\n		inner join plugin_courses_bookings_has_schedules hs on b.id = hs.booking_id\r\n		inner join plugin_courses_schedules s on hs.schedule_id = s.id\r\n		inner join plugin_courses_courses c on s.course_id = c.id\r\n		left join plugin_courses_categories a on c.category_id = a.id\r\n		left join plugin_courses_locations l on s.location_id = l.id\r\n		left join plugin_courses_bookings_has_transactions ht on b.id = ht.booking_id and (ht.booking_has_schedule_id is null or ht.booking_has_schedule_id = hs.id)\r\n		left join plugin_transactions_transactions t on ht.transaction_id = t.id\r\n		left join plugin_transactions_transactions_outstanding o on t.id = o.transaction_id\r\n	where hs.deleted = 0 and ht.deleted = 0 and s.id in ({!schedule_id!})\r\n	' WHERE (`name` = 'Classes Booked');
