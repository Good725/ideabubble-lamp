/*
ts:2015-11-29 00:00:00
*/
insert into `plugin_reports_reports` set `name` = 'Extra Services Payment Due', `summary` = '', `sql` = 'DROP TEMPORARY TABLE IF EXISTS tmp_invoices;\nCREATE TEMPORARY TABLE tmp_invoices AS (\nSELECT MAX(date_to) AS date_to, service_id\n	FROM plugin_extra_invoices\n	WHERE deleted=0 AND `status` <> \'Cancelled\'\n	GROUP BY service_id);\nALTER TABLE tmp_invoices ADD INDEX (`service_id`);\n\nSELECT	\n		services.id AS `Service ID`,\n		services.url AS `Url`,\n		services.ip_address AS `IP Address`,\n		billing_frequencies.friendly_name AS `Frequency`,\n		service_types.friendly_name AS `Service Type`,\n		stats.friendly_name AS `Status`,\n		services.price - IFNULL(services.discount, 0) AS `Price`,\n		companies.company_title AS `Company`,\n		companies.phone AS `Phone`,\n		CONCAT_WS(\' \', main_contact.first_name, main_contact.last_name) AS `Contact`,\n		main_contact.email AS `Email`,\n		CONCAT_WS(\' \', billing_contact.first_name, billing_contact.last_name) AS `Contact`,\n		IF(cards.id, \'YES\', \'NO\') AS `Has Cards`,\n		IFNULL(tmp_invoices.date_to, \'No Invoice\') AS `Expired`\n		\n	FROM plugin_extra_services services\n		INNER JOIN plugin_extra_customers companies \n			ON services.company_id = companies.id\n		INNER JOIN plugin_extra_service_types service_types \n			ON services.type_id = service_types.id\n		INNER JOIN plugin_extra_billing_frequency billing_frequencies\n			ON services.billing_frequency_id = billing_frequencies.id\n		INNER JOIN plugin_extra_status stats \n			ON services.status_id = stats.id\n		LEFT JOIN tmp_invoices \n			ON services.id = tmp_invoices.service_id\n		LEFT JOIN plugin_extra_realvault_cards cards\n			ON services.company_id = cards.customer_id\n		LEFT JOIN plugin_contacts_contact main_contact \n			ON companies.contact = main_contact.id\n		LEFT JOIN plugin_contacts_contact billing_contact \n			ON companies.billing_contact = billing_contact.id\n    WHERE \n			services.`delete` = 0 AND \n			services.publish = 1 AND\n			(tmp_invoices.date_to < NOW() OR tmp_invoices.service_id IS NULL)\n    GROUP BY services.id', `widget_sql` = '', `category` = '0', `sub_category` = '0', `dashboard` = '0', `created_by` = null, `modified_by` = null, `date_created` = '2015-11-30 01:22:15', `date_modified` = '2015-11-30 01:22:15', `publish` = '1', `delete` = '0', `widget_id` = '19', `chart_id` = '14', `link_url` = '', `link_column` = '', `report_type` = 'sql', `autoload` = '0', `checkbox_column` = '0', `action_button_label` = '', `action_button` = '0', `action_event` = '', `checkbox_column_label` = '', `autosum` = '0', `column_value` = '', `autocheck` = '0', `custom_report_rules` = '', `bulk_message_sms_number_column` = '', `bulk_message_email_column` = '', `bulk_message_subject_column` = '', `bulk_message_subject` = 'Service Ended', `bulk_message_body_column` = '', `bulk_message_body` = 'Dear\n{Company}\n\n, your domain\n{Url}\n\nis due to expire on the\n{Expired}\n\nThe amount required to renew your service is :\n{Price}\n\ninc VAT.\nPlease pay by visiting the pay now link here : https://www.ideabubble.ie/pay-online.html', `bulk_message_interval` = '', `rolledback_to_version` = null, `php_modifier` = '';
insert into `plugin_reports_reports` set `name` = 'Extra Services Expired', `summary` = '', `sql` = 'SELECT	\n		services.id AS `Service ID`,\n		services.url AS `Url`,\n		services.ip_address AS `IP Address`,\n		services.date_end AS `Ended`,\n		billing_frequencies.friendly_name AS `Frequency`,\n		service_types.friendly_name AS `Service Type`,\n		stats.friendly_name AS `Status`,\n		services.price - IFNULL(services.discount, 0) AS `Price`,\n		companies.company_title AS `Company`,\n		companies.phone AS `Phone`,\n		CONCAT_WS(\' \', main_contact.first_name, main_contact.last_name) AS `Contact`,\n		main_contact.email AS `Email`,\n		CONCAT_WS(\' \', billing_contact.first_name, billing_contact.last_name) AS `Billing Contact`\n		\n	FROM plugin_extra_services services\n		INNER JOIN plugin_extra_customers companies \n			ON services.company_id = companies.id\n		INNER JOIN plugin_extra_service_types service_types \n			ON services.type_id = service_types.id\n		INNER JOIN plugin_extra_billing_frequency billing_frequencies\n			ON services.billing_frequency_id = billing_frequencies.id\n		INNER JOIN plugin_extra_status stats \n			ON services.status_id = stats.id\n		LEFT JOIN plugin_contacts_contact main_contact \n			ON companies.contact = main_contact.id\n		LEFT JOIN plugin_contacts_contact billing_contact \n			ON companies.billing_contact = billing_contact.id\n    WHERE \n			services.`delete` = 0 AND \n			services.publish = 1 AND\n			services.date_end < NOW()', `widget_sql` = '', `category` = '0', `sub_category` = '0', `dashboard` = '0', `created_by` = null, `modified_by` = null, `date_created` = '2015-11-30 01:23:48', `date_modified` = '2015-11-30 01:23:48', `publish` = '1', `delete` = '0', `widget_id` = '20', `chart_id` = '15', `link_url` = '', `link_column` = '', `report_type` = 'sql', `autoload` = '0', `checkbox_column` = '0', `action_button_label` = '', `action_button` = '0', `action_event` = '', `checkbox_column_label` = '', `autosum` = '0', `column_value` = '', `autocheck` = '0', `custom_report_rules` = '', `bulk_message_sms_number_column` = '', `bulk_message_email_column` = 'Email', `bulk_message_subject_column` = '', `bulk_message_subject` = 'Service Expired', `bulk_message_body_column` = '', `bulk_message_body` = 'Dear\n{Company}\n\n, your domain\n{Url}\n\nis due to expire on the\n{Ended}\n\nThe amount required to renew your service is :\n{Price}\n\ninc VAT.\nPlease pay by visiting the pay now link here : https://www.ideabubble.ie/pay-online.html', `bulk_message_interval` = '', `rolledback_to_version` = null, `php_modifier` = '';

