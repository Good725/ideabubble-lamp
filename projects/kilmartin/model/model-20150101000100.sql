/*
ts:2015-01-01 00:01:00
*/

INSERT IGNORE INTO `plugin_formbuilder_forms` (`form_name`, `action`, `method`, `fields`, `publish`, `date_modified`, `captcha_enabled`, `form_id`) VALUES
(
    'QuickPaymentForm',
    'frontend/formprocessor/',
    'POST',
    '<input type=\"hidden\" name=\"item_name\" value=\"Quick Order\"><li><fieldset id=\"payment_form_payment_details_fieldset\"><legend>Payment Details</legend><ul><li><label for=\"payment_total\">â‚¬</label><input type=\"text\" name=\"payment_total\" id=\"payment_total\" class=\"validate[required]\"></li><li><label for=\"name\">Name</label><input type=\"text\" name=\"payment_form_name\" id=\"name\" class=\"validate[required]\"></li><li><label for=\"phone\">Phone</label><input type=\"text\" name=\"phone\" id=\"phone\" class=\"validate[required]\"></li><li><label for=\"email\">Email</label><input type=\"text\" name=\"email\" id=\"email\" class=\"validate[required]\"></li><li><label for=\"comments\">Comments</label><textarea name=\"comments\" id=\"comments\"></textarea></li></ul></fieldset></li><li><fieldset id=\"payment_form_payment_select_fieldset\"><legend>Payment Select</legend><ul><li><label></label><input type=\"radio\" name=\"payment_method\" value=\"Realex\" id=\"payment_form_method_cc\" checked=\"\" class=\"payment_select payment_select_cc\"><label for=\"payment_form_method_cc\"> Credit Card</label>\n<input type=\"radio\" name=\"payment_method\" value=\"PayPal\" id=\"payment_form_method_paypal\" class=\"payment_select payment_select_paypal\"><label for=\"payment_form_method_paypal\"> PayPal</label></li></ul></fieldset></li><li><fieldset id=\"payment_form_cc_payment_fieldset\"><legend>Credit Card Payment</legend><ul><li><label for=\"payment_form_ccType\">Card Type</label><select name=\"ccType\" id=\"ccType\"><option value=\"\"> Please Select </option><option value=\"visa\">Visa</option><option value=\"mc\">MasterCard</option><option value=\"laser\">Laser</option></select></li><li><label for=\"payment_form_ccName\">Name on Card</label><input type=\"text\" name=\"ccName\" id=\"ccName\" class=\"validate[required]\"></li><li><label for=\"payment_form_ccNum\">Card Number</label><input type=\"text\" name=\"ccNum\" id=\"ccNum\" class=\"validate[required]\"></li><li><label for=\"payment_form_ccv\">CCV Number</label><input type=\"text\" name=\"ccv\" id=\"ccv\" class=\"validate[required]\"></li>\n<li><label for=\"payment_form_ccExpMM\">Expiry Month</label><select name=\"ccExpMM\" id=\"ccExpMM\" class=\"validate[required]\"><option value=\"\"> MM </option><option value=\"01\">01</option><option value=\"02\">02</option><option value=\"03\">03</option><option value=\"04\">04</option><option value=\"05\">05</option><option value=\"06\">06</option><option value=\"07\">07</option><option value=\"08\">08</option><option value=\"09\">09</option><option value=\"10\">10</option><option value=\"11\">11</option><option value=\"12\">12</option></select></li><li><label for=\"payment_form_ccExpMM\">Expiry Year</label><select name=\"ccExpYY\" id=\"ccExpYY\" class=\"validate[required]\"><option value=\"\"> YYYY </option><option value=\"15\">2015</option><option value=\"16\">2016</option><option value=\"17\">2017</option><option value=\"18\">2018</option><option value=\"19\">2019</option><option value=\"20\">2020</option><option value=\"21\">2021</option><option value=\"22\">2022</option><option value=\"23\">2023</option><option value=\"24\">2024</option><option value=\"25\">2025</option></select></li></ul></fieldset></li><li><label for=\"pay_online_submit_button\"></label><button type=\"submit\" id=\"pay_online_submit_button\">Pay Now</button></li>',
    '1',
    CURRENT_TIMESTAMP(),
    '0',
    'quick_payment_form'
);

INSERT IGNORE INTO `ppages` (`name_tag`, `title`, `content`, `date_entered`, `last_modified`, `publish`, `deleted`, `include_sitemap`, `layout_id`, `category_id`) VALUES
('quick-pay-now.html', 'quick-pay-now', '<div class=\"formrt\">{form-QuickPaymentForm}</div>\n', CURRENT_TIMESTAMP(), CURRENT_TIMESTAMP(), '1', '0', '1', '1', '1');

INSERT IGNORE INTO `plugin_formbuilder_forms` (`form_name`, `action`, `method`, `fields`, `publish`, `date_modified`, `captcha_enabled`, `form_id`) VALUES
(
    'CompetitionForm',
    'frontend/formprocessor/',
    'POST',
    '<input name=\"subject\" value=\"Competition Entry\" type=\"hidden\" id=\"\"><input name=\"redirect\" value=\"thank-you.html\" type=\"hidden\"><input name=\"event\" value=\"contact-form\" type=\"hidden\" id=\"\"><input name=\"trigger\" value=\"custom_form\" type=\"hidden\" id=\"trigger\"><input name=\"form_type\" value=\"Competition Form\" id=\"form_type\" type=\"hidden\"><input type=\"hidden\" name=\"email_template\" id=\"\" value=\"competition_form_mail\"><li><label for=\"competition_form_name\">Name</label><input type=\"text\" name=\"name\" id=\"competition_form_name\" class=\"validate[required]\"></li><li><label for=\"competition_form_email\">Email</label><input type=\"text\" name=\"email\" id=\"competition_form_email\" class=\"validate[required]\"></li><li><label for=\"competition_form_answer\">Your Answer</label><textarea name=\"answer\" id=\"competition_form_answer\" class=\"validate[required]\"></textarea></li>\n<li><label for=\"competition_form_terms\" style=\"float: none;\">I accept the <a href=\"/terms-and-conditions.html\">terms and conditions</a></label><input type=\"checkbox\" id=\"competition_form_terms\" name=\"terms\" style=\"margin: .2em .5em; float: left;\" class=\"validate[required]\"></li>                                <li><label for=\"submit1\"></label><button type=\"submit\" class=\"enter_competition_button\">Enter Competition</button></li>',
    '1',
    CURRENT_TIMESTAMP(),
    '0',
    'competition_form'
);

INSERT IGNORE INTO `ppages` (`name_tag`, `title`, `content`, `date_entered`, `last_modified`, `publish`, `deleted`, `include_sitemap`, `layout_id`, `category_id`) VALUES
('competition.html', 'Competition', '<div class=\"formrt\">{form-CompetitionForm}</div>\n', CURRENT_TIMESTAMP(), CURRENT_TIMESTAMP(), '1', '0', '1', '1', '1');

UPDATE `plugin_formbuilder_forms`
SET `fields` = '<input type=\"hidden\" name=\"item_name\" value=\"Quick Order\"><li><fieldset id=\"payment_form_payment_details_fieldset\"><legend>Payment Details</legend><ul><li><label for=\"payment_total\">&euro;</label><input type=\"text\" name=\"payment_total\" id=\"payment_total\" class=\"validate[required]\"></li><li><label for=\"name\">Name</label><input type=\"text\" name=\"payment_form_name\" id=\"name\" class=\"validate[required]\"></li><li><label for=\"phone\">Phone</label><input type=\"text\" name=\"phone\" id=\"phone\" class=\"validate[required]\"></li><li><label for=\"email\">Email</label><input type=\"text\" name=\"email\" id=\"email\" class=\"validate[required]\"></li><li><label for=\"comments\">Comments</label><textarea name=\"comments\" id=\"comments\"></textarea></li></ul></fieldset></li><li><fieldset id=\"payment_form_payment_select_fieldset\"><legend>Payment Select</legend><ul><li><label></label><input type=\"radio\" name=\"payment_method\" value=\"Realex\" id=\"payment_form_method_cc\" checked=\"\" class=\"payment_select payment_select_cc\"><label for=\"payment_form_method_cc\"> Credit Card</label>\n<input type=\"radio\" name=\"payment_method\" value=\"PayPal\" id=\"payment_form_method_paypal\" class=\"payment_select payment_select_paypal\"><label for=\"payment_form_method_paypal\"> PayPal</label></li></ul></fieldset></li><li><fieldset id=\"payment_form_cc_payment_fieldset\"><legend>Credit Card Payment</legend><ul><li><label for=\"payment_form_ccType\">Card Type</label><select name=\"ccType\" id=\"ccType\"><option value=\"\"> Please Select </option><option value=\"visa\">Visa</option><option value=\"mc\">MasterCard</option><option value=\"laser\">Laser</option></select></li><li><label for=\"payment_form_ccName\">Name on Card</label><input type=\"text\" name=\"ccName\" id=\"ccName\" class=\"validate[required]\"></li><li><label for=\"payment_form_ccNum\">Card Number</label><input type=\"text\" name=\"ccNum\" id=\"ccNum\" class=\"validate[required]\"></li><li><label for=\"payment_form_ccv\">CCV Number</label><input type=\"text\" name=\"ccv\" id=\"ccv\" class=\"validate[required]\"></li>\n<li><label for=\"payment_form_ccExpMM\">Expiry Month</label><select name=\"ccExpMM\" id=\"ccExpMM\" class=\"validate[required]\"><option value=\"\"> MM </option><option value=\"01\">01</option><option value=\"02\">02</option><option value=\"03\">03</option><option value=\"04\">04</option><option value=\"05\">05</option><option value=\"06\">06</option><option value=\"07\">07</option><option value=\"08\">08</option><option value=\"09\">09</option><option value=\"10\">10</option><option value=\"11\">11</option><option value=\"12\">12</option></select></li><li><label for=\"payment_form_ccExpMM\">Expiry Year</label><select name=\"ccExpYY\" id=\"ccExpYY\" class=\"validate[required]\"><option value=\"\"> YYYY </option><option value=\"15\">2015</option><option value=\"16\">2016</option><option value=\"17\">2017</option><option value=\"18\">2018</option><option value=\"19\">2019</option><option value=\"20\">2020</option><option value=\"21\">2021</option><option value=\"22\">2022</option><option value=\"23\">2023</option><option value=\"24\">2024</option><option value=\"25\">2025</option></select></li></ul></fieldset></li><li><label for=\"pay_online_submit_button\"></label><button type=\"submit\" id=\"pay_online_submit_button\">Pay Now</button></li>'
WHERE `form_name` = 'QuickPaymentForm';

INSERT IGNORE INTO `plugin_courses_location_types` (`type`) VALUE ('School');
DELETE IGNORE FROM `plugin_courses_location_types` WHERE `type`='School';

-- KES-500: Report Outstanding Transactions - Prepay
insert into `plugin_reports_reports` set `name` = 'Outstanding Transactions - Prepay', `summary` = '', `sql` = 'SELECT\nt.id AS `Transaction Id`,\nt4.type AS `Transaction Type`,\nb.booking_id AS `Booking Id`,\nCONCAT(c3.first_name, \' \', c3.last_name) AS `Booking Name`,\nt.payment_due_date AS `Due Date`,\n(t.amount - COALESCE(\n(\nSELECT\nSUM(t1.amount)\nFROM\nplugin_bookings_transactions_payments AS `t1`\nJOIN plugin_bookings_transactions_payments_statuses AS `t2` ON t1.`status` = t2.id\nWHERE\nt1.transaction_id = t.id\n),\n0\n)) AS `Amount Due`,\ns.`name` AS `Schedule`,\nCONCAT(c.title,\' \',c.first_name,\' \',c.last_name) AS `Payee`\nFROM\nplugin_bookings_transactions `t`\nINNER JOIN plugin_bookings_transactions_types `t4` ON t4.id = t.type\nINNER JOIN plugin_ib_educate_bookings `b` ON t.booking_id = b.booking_id\nINNER JOIN plugin_contacts3_contacts `c` ON t.contact_id = c.id\nINNER JOIN plugin_courses_schedules `s` ON b.schedule_id = s.id\nINNER JOIN plugin_courses_schedules_events `c4` ON s.id = c4.id\nINNER JOIN plugin_courses_courses `c2` ON s.course_id = c2.id\nINNER JOIN plugin_contacts3_contacts `c3` ON c3.id = b.contact_id\nWHERE\nt4.type = \'Booking - Pay Now\'\nAND t.payment_due_date >= \'{!From!}\'\nAND t.payment_due_date < DATE_ADD(\'{!To!}\', INTERVAL 1 DAY)\nHAVING\n`Amount Due` > 0', `category` = '0', `sub_category` = '0', `dashboard` = '1', `created_by` = null, `modified_by` = null, `date_created` = '2015-07-13 14:54:57', `date_modified` = '2015-07-13 14:54:57', `publish` = '1', `delete` = '0', `widget_id` = '18', `chart_id` = '14', `link_url` = '', `link_column` = '', `report_type` = 'sql', `autoload` = '1', `checkbox_column` = '0', `action_button_label` = '', `action_button` = '0', `action_event` = null, `checkbox_column_label` = '', `autosum` = '0', `column_value` = '', `autocheck` = '0', `custom_report_rules` = '', `bulk_message_sms_number_column` = '', `bulk_message_email_column` = '', `bulk_message_subject_column` = '', `bulk_message_subject` = '', `bulk_message_body_column` = '', `bulk_message_body` = '', `bulk_message_interval` = '', `rolledback_to_version` = null;
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '13-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '13-07-2015', `delete` = '0';

-- KES-532
insert into `plugin_reports_reports` set `name` = 'Cash In', `summary` = '', `sql` = 'SELECT\nb.booking_id AS `Booking ID`,\nCONCAT(c2.first_name, \' \', c2.last_name) AS `Name`,\nCONCAT_WS(\' \', c1.title, c1.first_name, c1.last_name) AS `Payee`,\np.created AS `Payment Create Date`,\np.updated AS `Payment Update Date`,\nCONCAT(p.currency, \' \', (p.amount)) AS `Payment Amount`,\np.type AS `Payment Type`,\nt2.id AS `Transaction ID`,\nt3.type AS `Transaction Type`,\np.bank_fee AS `Bank Free`\nFROM\nplugin_bookings_transactions_payments AS `p`\nINNER JOIN plugin_bookings_transactions_payments_statuses AS `ps` ON p.`status` = ps.id\nINNER JOIN plugin_bookings_transactions AS `t2` ON p.transaction_id = t2.id\nINNER JOIN plugin_bookings_transactions_types AS `t3` ON t2.type = t3.id\nINNER JOIN plugin_contacts3_contacts AS `c1` ON t2.contact_id = c1.id\nINNER JOIN plugin_ib_educate_bookings AS `b` ON t2.booking_id = b.booking_id\nINNER JOIN plugin_contacts3_contacts AS `c2` ON b.contact_id = c2.id\n\nWHERE p.created >= \'{!From!}\' AND p.created < \'{!To!}\'\n\nORDER BY p.created DESC', `category` = '0', `sub_category` = '0', `dashboard` = '0', `created_by` = null, `modified_by` = null, `date_created` = '2015-07-13 15:49:19', `date_modified` = '2015-07-13 15:49:19', `publish` = '1', `delete` = '0', `widget_id` = '35', `chart_id` = '31', `link_url` = '', `link_column` = '', `report_type` = 'sql', `autoload` = '1', `checkbox_column` = '0', `action_button_label` = '', `action_button` = '0', `action_event` = null, `checkbox_column_label` = '', `autosum` = '0', `column_value` = '', `autocheck` = '0', `custom_report_rules` = '', `bulk_message_sms_number_column` = '', `bulk_message_email_column` = '', `bulk_message_subject_column` = '', `bulk_message_subject` = '', `bulk_message_body_column` = '', `bulk_message_body` = '', `bulk_message_interval` = '', `rolledback_to_version` = null;
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '13-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '13-07-2015', `delete` = '0';

-- KES-498
insert into `plugin_reports_reports` set `name` = 'List Absentee', `summary` = '', `sql` = 'SELECT\n	b.booking_id AS `Booking ID`,\n	CONCAT(cn.first_name,\' \',cn.last_name) AS `Name`,\n	CONCAT(s.`name`,\' - \',cu.title) AS `Schedule`,\n	e.datetime_start AS `Date Time`,\n	n.note AS `Note`\n	FROM plugin_ib_educate_bookings `b`\n		INNER JOIN plugin_ib_educate_booking_items `i` ON b.booking_id = i.booking_id AND b.`delete` = 0 AND i.`delete` = 0\n		INNER JOIN plugin_courses_schedules_events `e` ON i.period_id = e.id AND e.`delete` = 0\n		INNER JOIN plugin_courses_schedules `s` ON e.schedule_id = s.id AND s.`delete` = 0\n		INNER JOIN plugin_courses_courses `cu` ON cu.id=s.course_id AND cu.deleted = 0\n		INNER JOIN plugin_contacts3_contacts `cn` ON b.contact_id = cn.id AND cn.`delete` = 0\n		INNER JOIN plugin_contacts3_notes `n` ON ( n.link_id = i.booking_item_id AND n.table_link_id = 3 AND n.deleted = 0)\n	WHERE i.attending = 0 AND e.datetime_start >= \'{!From!}\' AND e.datetime_end < DATE_ADD(\'{!To!}\', INTERVAL 1 DAY)\n	AND n.note <> \'Booked after start date.\'\n		\n	ORDER BY e.datetime_start ASC', `category` = '0', `sub_category` = '0', `dashboard` = '1', `created_by` = null, `modified_by` = null, `date_created` = '2015-07-14 07:44:32', `date_modified` = '2015-07-14 07:44:32', `publish` = '1', `delete` = '0', `widget_id` = '26', `chart_id` = '22', `link_url` = '', `link_column` = '', `report_type` = 'sql', `autoload` = '1', `checkbox_column` = '0', `action_button_label` = '', `action_button` = '0', `action_event` = '', `checkbox_column_label` = '', `autosum` = '0', `column_value` = '', `autocheck` = '0', `custom_report_rules` = '', `bulk_message_sms_number_column` = '', `bulk_message_email_column` = '', `bulk_message_subject_column` = '', `bulk_message_subject` = '', `bulk_message_body_column` = '', `bulk_message_body` = '', `bulk_message_interval` = '', `rolledback_to_version` = null;
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '14-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '14-07-2015', `delete` = '0';

-- KES-502
insert into `plugin_reports_reports` set `name` = 'Cancelled Bookings', `summary` = '', `sql` = 'SELECT\n	b.booking_id AS `Booking ID`,\n	bs.title AS `Booking Status`,\n	CONCAT(c.first_name, \' \' ,c.last_name) AS `Booking Name`,\n	tt.type AS `Booking Type`,\n	t.updated AS `Cancelled Date`,\n	t.amount AS `Transaction Amount`\n	FROM plugin_ib_educate_bookings `b`\n		INNER JOIN plugin_ib_educate_bookings_status `bs` ON b.booking_status = bs.status_id\n		INNER JOIN plugin_contacts3_contacts `c` ON c.id = b.contact_id\n		INNER JOIN plugin_bookings_transactions `t` ON t.booking_id = b.booking_id\n		INNER JOIN plugin_bookings_transactions_types `tt` ON t.type = tt.id\nWHERE b.booking_status = 3\nAND t.updated >= \'{!From!}\' AND t.updated < DATE_ADD(\'{!To!}\', INTERVAL 1 DAY)', `category` = '0', `sub_category` = '0', `dashboard` = '1', `created_by` = null, `modified_by` = null, `date_created` = '2015-07-14 11:20:04', `date_modified` = '2015-07-14 11:20:04', `publish` = '1', `delete` = '0', `widget_id` = '23', `chart_id` = '19', `link_url` = '', `link_column` = '', `report_type` = 'sql', `autoload` = '1', `checkbox_column` = '0', `action_button_label` = '', `action_button` = '0', `action_event` = '', `checkbox_column_label` = '', `autosum` = '0', `column_value` = '', `autocheck` = '0', `custom_report_rules` = '', `bulk_message_sms_number_column` = '', `bulk_message_email_column` = '', `bulk_message_subject_column` = '', `bulk_message_subject` = '', `bulk_message_body_column` = '', `bulk_message_body` = '', `bulk_message_interval` = '', `rolledback_to_version` = null;
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '14-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '14-07-2015', `delete` = '0';

-- KES-533
insert into `plugin_reports_reports` set `name` = 'Oustanding Transactions - PAYG', `summary` = '', `sql` = 'SELECT\nt.id AS `Transaction Id`,\nt4.type AS `Transaction Type`,\nb.booking_id AS `Booking Id`,\nCONCAT(c3.first_name, \' \', c3.last_name) AS `Booking Name`,\nt.payment_due_date AS `Due Date`,\n(t.amount - COALESCE(\n(\nSELECT\nSUM(t1.amount)\nFROM\nplugin_bookings_transactions_payments AS `t1`\nJOIN plugin_bookings_transactions_payments_statuses AS `t2` ON t1.`status` = t2.id\nWHERE\nt1.transaction_id = t.id\n),\n0\n)) AS `Amount Due`,\ns.`name` AS `Schedule`,\nCONCAT(c.title,\' \',c.first_name,\' \',c.last_name) AS `Payee`\nFROM\nplugin_bookings_transactions `t`\nINNER JOIN plugin_bookings_transactions_types `t4` ON t4.id = t.type\nINNER JOIN plugin_ib_educate_bookings `b` ON t.booking_id = b.booking_id\nINNER JOIN plugin_contacts3_contacts `c` ON t.contact_id = c.id\nINNER JOIN plugin_courses_schedules `s` ON b.schedule_id = s.id\nINNER JOIN plugin_courses_schedules_events `c4` ON s.id = c4.id\nINNER JOIN plugin_courses_courses `c2` ON s.course_id = c2.id\nINNER JOIN plugin_contacts3_contacts `c3` ON c3.id = b.contact_id\nWHERE\nt4.type = \'Booking - PAYG\'\nAND t.payment_due_date >= \'{!From!}\'\nAND t.payment_due_date < DATE_ADD(\'{!To!}\', INTERVAL 1 DAY)\nHAVING\n`Amount Due` > 0', `category` = '0', `sub_category` = '0', `dashboard` = '1', `created_by` = null, `modified_by` = null, `date_created` = '2015-07-14 12:20:05', `date_modified` = '2015-07-14 12:20:05', `publish` = '1', `delete` = '0', `widget_id` = '28', `chart_id` = '24', `link_url` = '', `link_column` = '', `report_type` = 'sql', `autoload` = '1', `checkbox_column` = '0', `action_button_label` = '', `action_button` = '0', `action_event` = '', `checkbox_column_label` = '', `autosum` = '0', `column_value` = '', `autocheck` = '0', `custom_report_rules` = '', `bulk_message_sms_number_column` = '', `bulk_message_email_column` = '', `bulk_message_subject_column` = '', `bulk_message_subject` = '', `bulk_message_body_column` = '', `bulk_message_body` = '', `bulk_message_interval` = '', `rolledback_to_version` = null;
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '14-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '14-07-2015', `delete` = '0';

-- KES-502
update `plugin_reports_reports` set `sql` = 'SELECT\n	b.booking_id AS `Booking ID`,\n	bs.title AS `Booking Status`,\n	CONCAT(c.first_name, \' \' ,c.last_name) AS `Booking Name`,\n	tt.type AS `Booking Type`,\n	t.updated AS `Cancelled Date`,\n	t.amount AS `Transaction Amount`\n	FROM plugin_ib_educate_bookings `b`\n		INNER JOIN plugin_ib_educate_bookings_status `bs` ON b.booking_status = bs.status_id\n		INNER JOIN plugin_contacts3_contacts `c` ON c.id = b.contact_id\n		INNER JOIN plugin_bookings_transactions `t` ON t.booking_id = b.booking_id\n		INNER JOIN plugin_bookings_transactions_types `tt` ON t.type = tt.id\nWHERE b.booking_status = 3\nAND t.updated >= \'{!From!}\' AND t.updated < DATE_ADD(\'{!To!}\', INTERVAL 1 DAY)' where `name` = 'Cancelled Bookings';

INSERT INTO `plugin_reports_reports`
(`name`,`summary`,`sql`,`category`,`sub_category`,`dashboard`,`created_by`,`modified_by`,`date_created`,`date_modified`,`publish`,`delete`,`widget_id`,`chart_id`,`link_url`,`link_column`,`report_type`,`autoload`,`checkbox_column`,`action_button_label`,`action_button`,`action_event`,`checkbox_column_label`,`autosum`,`column_value`,`autocheck`,`custom_report_rules`,`bulk_message_sms_number_column`,`bulk_message_email_column`,`bulk_message_subject_column`,`bulk_message_subject`,`bulk_message_body_column`,`bulk_message_body`,`bulk_message_interval`,`rolledback_to_version`)
values
('Quick Stats', '', 'select count(*) as \'cnt\', \'Contacts\' as \'tbl\' from plugin_contacts3_contacts where `delete`=0\nunion\nselect count(*) as \'cnt\', \'Courses\' as \'tbl\' from plugin_courses_courses where deleted=0\nunion\nselect count(*) as \'cnt\', \'News\' as \'tbl\' from plugin_news where deleted=0\nunion\nselect count(*) as \'cnt\', \'Files\' as \'tbl\' from plugin_files_file where deleted=0\nunion\nselect count(*) as \'cnt\', \'Schedules\' as \'tbl\' from plugin_courses_schedules where `delete`=0', '0', '0', '1', null, null, '2015-07-23 15:07:53', '2015-07-23 15:07:53', '1', '0', '24', '24', '', '', 'sql', '0', '0', '', '0', '                                                                                                                                                                                                                                                                                                ', '', '0', '', '0', '', '', '', '', '', '', '', '', null),
('Attendee VS Absentee', '', 'select count(*) as \'count\',\nCASE  \n  WHEN attending =1 THEN \'Present\' \n ELSE \'Absent\'\n END as \'Present\'\nFROM\nplugin_ib_educate_booking_items\nwhere `delete` = 0\ngroup by attending', '0', '0', '1', null, null, '2015-07-27 12:07:25', '2015-07-27 12:07:25', '1', '0', '25', '21', '', '', 'sql', '0', '0', '', '0', '                                                                                                                                                                                    ', '', '0', '', '0', '', '', '', '', '', '', '', '', null);

INSERT INTO `plugin_reports_reports`
(`name`,`summary`,`sql`,`category`,`sub_category`,`dashboard`,`created_by`,`modified_by`,`date_created`,`date_modified`,`publish`,`delete`,`widget_id`,`chart_id`,`link_url`,`link_column`,`report_type`,`autoload`,`checkbox_column`,`action_button_label`,`action_button`,`action_event`,`checkbox_column_label`,`autosum`,`column_value`,`autocheck`,`custom_report_rules`,`bulk_message_sms_number_column`,`bulk_message_email_column`,`bulk_message_subject_column`,`bulk_message_subject`,`bulk_message_body_column`,`bulk_message_body`,`bulk_message_interval`,`rolledback_to_version`)
values
('Outstanding PAYG', '', 'SELECT\n	CONCAT(c.first_name, \' \', c.last_name)AS `Student`,\n	t.amount AS `Class Fee`,\n	CONCAT(\n		\'Next Class: \',\n		DATE_FORMAT(\n			c4.datetime_start,\n			\'%a %D %b - %H:%i\'\n		)\n	)AS `Next Attending`,\n	CONCAT(c1.`name`, \' \', c2.title)AS `Course`,\n	CONCAT(\n		\'Transaction #\',\n		t.id,\n		\' \',\n		t4.type\n	)AS `Transaction`,\n	(\n		t.total - COALESCE(\n			(\n				SELECT\n					SUM(t1.amount)\n				FROM\n					plugin_bookings_transactions_payments AS `t1`\n				JOIN plugin_bookings_transactions_payments_statuses AS `t2` ON t1.`status` = t2.id\n				WHERE\n					t2.credit = 1\n				AND t1.transaction_id = t.id\n			),\n			0\n		)+ COALESCE(\n			(\n				SELECT\n					SUM(t1.amount)\n				FROM\n					plugin_bookings_transactions_payments AS `t1`\n				JOIN plugin_bookings_transactions_payments_statuses AS `t2` ON t1.`status` = t2.id\n				WHERE\n					t2.credit = 0\n				AND t1.transaction_id = t.id\n			),\n			0\n		)\n	)AS `Total Due`\nFROM\n	plugin_bookings_transactions t\nINNER JOIN plugin_bookings_transactions_types t4 ON t4.id = t.type\nINNER JOIN plugin_ib_educate_bookings b ON t.booking_id = b.booking_id\nINNER JOIN plugin_contacts3_contacts c ON t.contact_id = c.id\nINNER JOIN plugin_bookings_transactions_has_schedule t5 ON t.id = t5.transaction_id\nINNER JOIN plugin_courses_schedules c1 ON t5.schedule_id = c1.id\nINNER JOIN plugin_courses_schedules_events c4 ON c1.id = c4.id\nINNER JOIN plugin_courses_courses c2 ON c1.course_id = c2.id\nINNER JOIN plugin_contacts3_contacts c3 ON c3.id = b.contact_id\nWHERE\n	t4.type = \'Booking - PAYG\'\nAND `c4`.`datetime_start` >= \"{!From!}\" 	AND `c4`.`datetime_start` <  \"{!To!}\"\nHAVING\n	`Total Due` > 0', '0', '0', '1', null, null, '2015-07-27 12:02:58', '2015-07-27 12:02:58', '1', '0', '18', '14', '', '', 'sql', '1', '0', '', '0', '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ', '', '0', '', '0', '', '', '', '', '', '', '', '', null);
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '14-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '14-07-2015', `delete` = '0';

INSERT INTO `plugin_reports_reports`
(`name`,`summary`,`sql`,`category`,`sub_category`,`dashboard`,`created_by`,`modified_by`,`date_created`,`date_modified`,`publish`,`delete`,`widget_id`,`chart_id`,`link_url`,`link_column`,`report_type`,`autoload`,`checkbox_column`,`action_button_label`,`action_button`,`action_event`,`checkbox_column_label`,`autosum`,`column_value`,`autocheck`,`custom_report_rules`,`bulk_message_sms_number_column`,`bulk_message_email_column`,`bulk_message_subject_column`,`bulk_message_subject`,`bulk_message_body_column`,`bulk_message_body`,`bulk_message_interval`,`rolledback_to_version`)
values
('RAB', '', 'SELECT  	CONCAT( 		TIME_FORMAT(`event`.`datetime_start`, \'%H:%i\'), 		\'-\', 		TIME_FORMAT(`event`.`datetime_end`,   \'%H:%i\') 	) AS `Time`, 	DATE_FORMAT(`event`.`datetime_start`, \'%W\') AS `Day`, 	CONCAT(\'<a href=\"/admin/courses/edit_schedule/?id=\', `schedule`.`id`, \'\">\', `schedule`.`name`, \'</a>\') AS `Class`, 	CONCAT(\'<a href=\"/admin/courses/edit_location/?id=\', `location`.`id`, \'\">\', `location`.`name`, \'</a>\') AS `Room`, 	CONCAT(\'<a href=\"/admin/contacts3/?contact=\', `trainer`.`id`, \'\">\', `trainer`.`first_name`, \' \', `trainer`.`last_name`, \'</a>\') AS `Trainer` FROM `plugin_courses_schedules_events` `event` JOIN `plugin_courses_schedules`        `schedule` ON `event`.   `schedule_id` = `schedule`.`id` JOIN `plugin_courses_courses`          `course`   ON `schedule`.`course_id`   = `course`  .`id` LEFT JOIN ( 	SELECT *  	FROM `plugin_courses_locations`  	WHERE `delete` = 0 	AND `location_type_id` = 2 ) `location`  ON `schedule`.`location_id` = `location`.`id` LEFT JOIN (SELECT * FROM `plugin_contacts3_contacts` WHERE `delete` = 0) `trainer` ON `schedule`.`trainer_id` = `trainer`.`id` WHERE  	    `event`   .`delete`  = 0 	AND `schedule`.`delete`  = 0 	AND `course`  .`deleted` = 0 	AND `event`.`datetime_start` >= \"{!From!}\" 	AND `event`.`datetime_start` <  \"{!To!}\" 	AND `location`.`id` IN ({!LocationIDs!}) 	AND `trainer`.`id` IN ({!TrainerIDs!}) ORDER BY `datetime_start` ASC', '0', '0', '1', null, null, '2015-07-27 12:10:47', '2015-07-27 12:10:47', '1', '0', '17', '12', '', '', 'sql', '0', '0', '', '0', '                                                                                                            ', '', '0', '', '0', '', '', '', '', '', '', '', '', null);
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '14-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '14-07-2015', `delete` = '0';

INSERT INTO `plugin_reports_reports`
(`name`,`summary`,`sql`,`category`,`sub_category`,`dashboard`,`created_by`,`modified_by`,`date_created`,`date_modified`,`publish`,`delete`,`widget_id`,`chart_id`,`link_url`,`link_column`,`report_type`,`autoload`,`checkbox_column`,`action_button_label`,`action_button`,`action_event`,`checkbox_column_label`,`autosum`,`column_value`,`autocheck`,`custom_report_rules`,`bulk_message_sms_number_column`,`bulk_message_email_column`,`bulk_message_subject_column`,`bulk_message_subject`,`bulk_message_body_column`,`bulk_message_body`,`bulk_message_interval`,`rolledback_to_version`)
values
('Yearly Prepay', '', 'SELECT\nCONCAT(c.first_name,\' \',c.last_name) AS `Students`\nFROM\n	plugin_contacts3_contacts `c`\nWHERE\n	c.id IN(\n		SELECT DISTINCT\n			b0.contact_id\n		FROM\n			plugin_ib_educate_bookings `b0`\n		HAVING\n			(\n				SELECT\n					COUNT(*)\n				FROM\n					plugin_ib_educate_bookings `b`\n				INNER JOIN plugin_ib_educate_booking_items `b1` ON b.booking_id = b1.booking_id\n				WHERE\n					b1.attending = 1\n				AND b.contact_id = b0.contact_id\n			)> 250\n	)\nAND c.id IN(\n	SELECT DISTINCT\n		b.contact_id\n	FROM\n		plugin_ib_educate_bookings `b`\n	INNER JOIN plugin_bookings_transactions `t`\n	ON t.booking_id = b.booking_id\n	INNER JOIN plugin_bookings_transactions_types `t1`\n	ON t1.id = t.type\n	WHERE\n		b.schedule_id IN(\n			SELECT\n				c03.id\n			FROM\n				plugin_courses_categories `c01`\n			INNER JOIN plugin_courses_courses `c02` ON c01.id = c02.category_id\n			INNER JOIN plugin_courses_schedules `c03` ON c02.id = c03.course_id\n			WHERE\n				c01.category = \'August Preparation Course \'\n		)\n	AND t1.type = \'Booking - Pay Now\'\n)', '0', '0', '0', null, null, '2015-07-23 14:44:04', '2015-07-23 14:44:04', '1', '0', '20', '16', '', '', 'sql', '0', '0', '', '0', '                                                                        ', '', '0', '', '0', '', '', '', '', '', '', '', '', null);
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '14-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '14-07-2015', `delete` = '0';

INSERT INTO `plugin_reports_reports`
(`name`,`summary`,`sql`,`category`,`sub_category`,`dashboard`,`created_by`,`modified_by`,`date_created`,`date_modified`,`publish`,`delete`,`widget_id`,`chart_id`,`link_url`,`link_column`,`report_type`,`autoload`,`checkbox_column`,`action_button_label`,`action_button`,`action_event`,`checkbox_column_label`,`autosum`,`column_value`,`autocheck`,`custom_report_rules`,`bulk_message_sms_number_column`,`bulk_message_email_column`,`bulk_message_subject_column`,`bulk_message_subject`,`bulk_message_body_column`,`bulk_message_body`,`bulk_message_interval`,`rolledback_to_version`)
values
('Top 10 Vacancies', '', 'SELECT\n	CONCAT(l1.`name`, \' - \', l.`name`)AS `Name`,\n	l.capacity AS `Room Capacity`,\n	s2.max_capacity AS `Schedule Capacity`,\n	l.capacity - COALESCE(\n		(\n			SELECT\n				COUNT(b.attending)\n			FROM\n				plugin_ib_educate_booking_items `b`\n			INNER JOIN plugin_courses_schedules_events `s` ON b.period_id = s.id\n			INNER JOIN plugin_courses_schedules `s1` ON s.schedule_id = s1.id\n			WHERE\n				b.attending = 1\n			AND s.datetime_start >= \"{!From!}\"\n			AND s.datetime_start <= \"{!To!}\"\n			AND s1.location_id = l.id\n		),\n		0\n	)AS `Free Space`\nFROM\n	plugin_courses_locations `l`\nJOIN plugin_courses_locations `l1` ON l.parent_id = l1.id\nINNER JOIN plugin_courses_schedules `s2` ON s2.location_id = l.id \nWHERE\n	l.`delete` = 0\nORDER BY\n	NAME', '0', '0', '0', null, null, '2015-07-27 11:54:01', '2015-07-27 11:54:01', '1', '0', '21', '17', '', '', 'sql', '1', '0', '', '0', '                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ', '', '0', '', '0', '', '', '', '', '', '', '', '', null);
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '14-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '14-07-2015', `delete` = '0';

INSERT INTO `plugin_reports_reports`
(`name`,`summary`,`sql`,`category`,`sub_category`,`dashboard`,`created_by`,`modified_by`,`date_created`,`date_modified`,`publish`,`delete`,`widget_id`,`chart_id`,`link_url`,`link_column`,`report_type`,`autoload`,`checkbox_column`,`action_button_label`,`action_button`,`action_event`,`checkbox_column_label`,`autosum`,`column_value`,`autocheck`,`custom_report_rules`,`bulk_message_sms_number_column`,`bulk_message_email_column`,`bulk_message_subject_column`,`bulk_message_subject`,`bulk_message_body_column`,`bulk_message_body`,`bulk_message_interval`,`rolledback_to_version`)
values
('Free Rooms', '', 'SELECT\n	CONCAT(l1.`name`,\' - \',l.`name`)\n	 AS `Name`,\n	l.capacity AS `Capacity`\nFROM\n	plugin_courses_locations `l`\n	JOIN plugin_courses_locations `l1` ON l.parent_id = l1.id\nWHERE\n	l.`delete` = 0\nAND l.id NOT IN(\n	SELECT DISTINCT\n		plugin_courses_schedules.location_id\n	FROM\n		plugin_courses_schedules\n	INNER JOIN plugin_courses_schedules_events ON plugin_courses_schedules.id = plugin_courses_schedules_events.schedule_id\n	WHERE\n		plugin_courses_schedules_events.datetime_start >= \"{!From!}\"\nAND plugin_courses_schedules_events.datetime_start <= \"{!To!}\"\n)\nORDER BY Name', '0', '0', '1', null, null, '2015-07-27 11:58:32', '2015-07-27 11:58:32', '1', '0', '26', '22', '', '', 'sql', '1', '0', '', '0', '                                                                                                                                                                                                                                                            ', '', '0', '', '0', '', '', '', '', '', '', '', '', null);
	select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '14-07-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '14-07-2015', `delete` = '0';


UPDATE IGNORE `plugin_formbuilder_forms`
SET `fields` = '<input name="subject" value="Competition Entry" type="hidden" id=""><input name="redirect" value="thank-you.html" type="hidden"><input name="event" value="contact-form" type="hidden" id=""><input name="trigger" value="custom_form" type="hidden" id="trigger"><input name="form_type" value="Competition Form" id="form_type" type="hidden"><input type="hidden" name="email_template" id="" value="competition_form_mail"><li><label for="competition_form_student_name">Student Name</label><input type="text" name="student_name" id="competition_form_student_name" class="validate[required]" placeholder="Student Name"></li><li><label for="competition_form_year_in_school">Year in School</label><input type="text" name="year_in_school" id="competition_form_year_in_school" class="validate[required]" placeholder="Year in School"></li><li><label for="competition_form_guardian_name">Guardian Name</label><input type="text" name="guardian_name" id="competition_form_guardian_name" class="validate[required]" placeholder="Parent/Guardian Name"></li><li><label for="competiton_form_guardian_mobile">Guardian Mobile</label><input type="text" name="guardian_mobile" id="competiton_form_guardian_mobile" class="validate[required]" placeholder="Parent/Guardian Mobile Number"></li><li><label for="competition_form_guardian_email">Guardian Email</label><input type="text" name="guardian_email" id="competition_form_guardian_email" class="validate[required]" placeholder="Parent/Guardian Email"></li><li><label for="competition_form_answer">Your Answer</label><textarea name="answer" id="competition_form_answer" class="validate[required]" placeholder="Your Answer"></textarea></li> <li><label for="competition_form_terms" style="float: none;">I accept the <a href="/terms-and-conditions.html">terms and conditions</a></label><input type="checkbox" id="competition_form_terms" name="terms" style="margin: .2em .5em; float: left;" class="validate[required]"></li>                                <li><label for="submit1"></label><button type="submit" class="enter_competition_button">Enter Competition</button></li>'
WHERE `form_name` = 'CompetitionForm';

INSERT INTO `plugin_reports_reports`
(`name`,`summary`,`sql`,`category`,`sub_category`,`dashboard`,`created_by`,`modified_by`,`date_created`,`date_modified`,`publish`,`delete`,`widget_id`,`chart_id`,`link_url`,`link_column`,`report_type`,`autoload`,`checkbox_column`,`action_button_label`,`action_button`,`action_event`,`checkbox_column_label`,`autosum`,`column_value`,`autocheck`,`custom_report_rules`,`bulk_message_sms_number_column`,`bulk_message_email_column`,`bulk_message_subject_column`,`bulk_message_subject`,`bulk_message_body_column`,`bulk_message_body`,`bulk_message_interval`,`rolledback_to_version`)
values
('Cash In By Course Category', '', 'SELECT c1.category AS \'Category\', SUM(t.amount) AS \'Payment Amount\', t.type AS \'Payment Type\'\nFROM plugin_bookings_transactions_payments `t` INNER JOIN plugin_bookings_transactions_has_schedule `t1`ON t.transaction_id = t1.transaction_id\nINNER JOIN plugin_courses_schedules `s` ON t1.schedule_id = s.id\nINNER JOIN plugin_courses_courses `c` ON s.course_id = c.id\nINNER JOIN plugin_courses_categories `c1` ON c.category_id = c1.id\nINNER JOIN plugin_bookings_transactions_payments_statuses t2 ON t.`status` = t2.id\nWHERE t2.credit = 1 AND t2.`status` NOT LIKE \'%Credit%\' GROUP BY c1.category , t.type', '0', '0', '0', null, null, '2015-08-10 11:23:35', '2015-08-10 11:23:35', '1', '0', '37', '31', '', '', 'sql', '1', '0', '', '0', '																						', '', '0', '', '0', '', '', '', '', '', '', '', '', null);

UPDATE IGNORE `plugin_reports_reports` set `sql` = 'SELECT DISTINCT\n	COALESCE((\n		SELECT\n			SUM(\n				plugin_bookings_transactions_payments.amount\n			)\n		FROM\n			plugin_bookings_transactions\n		INNER JOIN plugin_bookings_transactions_payments ON plugin_bookings_transactions.id = plugin_bookings_transactions_payments.transaction_id\n		INNER JOIN plugin_bookings_transactions_payments_statuses ON plugin_bookings_transactions_payments.`status` = plugin_bookings_transactions_payments_statuses.id\n		INNER JOIN plugin_contacts3_contacts ON plugin_bookings_transactions.contact_id = plugin_contacts3_contacts.id\n		INNER JOIN plugin_contacts3_contact_type ON plugin_contacts3_contacts.type = plugin_contacts3_contact_type.contact_type_id\n		WHERE\n			plugin_contacts3_contact_type.contact_type_id = 1\n		AND credit = 1\n		AND plugin_bookings_transactions_payments.type != \'transfer\'\n		AND plugin_bookings_transactions_payments.created >= \"{!From!}\"\n		AND plugin_bookings_transactions_payments.created <= \"{!To!}\"\n	),0)AS \'Paid by students\',\n	COALESCE((\n		SELECT\n			SUM(\n				plugin_bookings_transactions_payments.amount\n			)\n		FROM\n			plugin_bookings_transactions\n		INNER JOIN plugin_bookings_transactions_payments ON plugin_bookings_transactions.id = plugin_bookings_transactions_payments.transaction_id\n		INNER JOIN plugin_bookings_transactions_payments_statuses ON plugin_bookings_transactions_payments.`status` = plugin_bookings_transactions_payments_statuses.id\n		INNER JOIN plugin_contacts3_contacts ON plugin_bookings_transactions.contact_id = plugin_contacts3_contacts.id\n		INNER JOIN plugin_contacts3_contact_type ON plugin_contacts3_contacts.type = plugin_contacts3_contact_type.contact_type_id\n		WHERE\n			plugin_contacts3_contact_type.contact_type_id = 1\n		AND credit = 0\n		AND plugin_bookings_transactions_payments.type != \'transfer\'\n		AND plugin_bookings_transactions_payments.created >= \"{!From!}\"\n		AND plugin_bookings_transactions_payments.created <= \"{!To!}\"\n	),0)AS \'Returned to students\',\n	COALESCE((\n		SELECT\n			SUM(\n				plugin_bookings_transactions_payments.amount\n			)\n		FROM\n			plugin_bookings_transactions\n		INNER JOIN plugin_bookings_transactions_payments ON plugin_bookings_transactions.id = plugin_bookings_transactions_payments.transaction_id\n		INNER JOIN plugin_bookings_transactions_payments_statuses ON plugin_bookings_transactions_payments.`status` = plugin_bookings_transactions_payments_statuses.id\n		INNER JOIN plugin_contacts3_contacts ON plugin_bookings_transactions.contact_id = plugin_contacts3_contacts.id\n		INNER JOIN plugin_contacts3_contact_type ON plugin_contacts3_contacts.type = plugin_contacts3_contact_type.contact_type_id\n		WHERE\n			plugin_contacts3_contact_type.contact_type_id = 4\n		AND credit = 1\n		AND plugin_bookings_transactions_payments.type != \'transfer\'\n		AND plugin_bookings_transactions_payments.created >= \"{!From!}\"\n		AND plugin_bookings_transactions_payments.created <= \"{!To!}\"\n	),0)AS \'Paid by Billing\',\n	COALESCE((\n		SELECT\n			SUM(\n				plugin_bookings_transactions_payments.amount\n			)\n		FROM\n			plugin_bookings_transactions\n		INNER JOIN plugin_bookings_transactions_payments ON plugin_bookings_transactions.id = plugin_bookings_transactions_payments.transaction_id\n		INNER JOIN plugin_bookings_transactions_payments_statuses ON plugin_bookings_transactions_payments.`status` = plugin_bookings_transactions_payments_statuses.id\n		INNER JOIN plugin_contacts3_contacts ON plugin_bookings_transactions.contact_id = plugin_contacts3_contacts.id\n		INNER JOIN plugin_contacts3_contact_type ON plugin_contacts3_contacts.type = plugin_contacts3_contact_type.contact_type_id\n		WHERE\n			plugin_contacts3_contact_type.contact_type_id = 4\n		AND credit = 0\n		AND plugin_bookings_transactions_payments.type != \'transfer\'\n		AND plugin_bookings_transactions_payments.created >= \"{!From!}\"\n		AND plugin_bookings_transactions_payments.created <= \"{!To!}\"\n	),0)AS \'Returned to Billing\',\n	COALESCE((\n		SELECT\n			SUM(\n				plugin_bookings_transactions_payments.amount\n			)\n		FROM\n			plugin_bookings_transactions\n		INNER JOIN plugin_bookings_transactions_payments ON plugin_bookings_transactions.id = plugin_bookings_transactions_payments.transaction_id\n		INNER JOIN plugin_bookings_transactions_payments_statuses ON plugin_bookings_transactions_payments.`status` = plugin_bookings_transactions_payments_statuses.id\n		INNER JOIN plugin_contacts3_contacts ON plugin_bookings_transactions.contact_id = plugin_contacts3_contacts.id\n		INNER JOIN plugin_contacts3_contact_type ON plugin_contacts3_contacts.type = plugin_contacts3_contact_type.contact_type_id\n		WHERE\n			plugin_contacts3_contact_type.contact_type_id = 3\n		AND credit = 1\n		AND plugin_bookings_transactions_payments.type != \'transfer\'\n		AND plugin_bookings_transactions_payments.created >= \"{!From!}\"\n		AND plugin_bookings_transactions_payments.created <= \"{!To!}\"\n	),0)AS \'Paid by Teacher\',\n	COALESCE((\n		SELECT\n			SUM(\n				plugin_bookings_transactions_payments.amount\n			)\n		FROM\n			plugin_bookings_transactions\n		INNER JOIN plugin_bookings_transactions_payments ON plugin_bookings_transactions.id = plugin_bookings_transactions_payments.transaction_id\n		INNER JOIN plugin_bookings_transactions_payments_statuses ON plugin_bookings_transactions_payments.`status` = plugin_bookings_transactions_payments_statuses.id\n		INNER JOIN plugin_contacts3_contacts ON plugin_bookings_transactions.contact_id = plugin_contacts3_contacts.id\n		INNER JOIN plugin_contacts3_contact_type ON plugin_contacts3_contacts.type = plugin_contacts3_contact_type.contact_type_id\n		WHERE\n			plugin_contacts3_contact_type.contact_type_id = 3\n		AND credit = 0\n		AND plugin_bookings_transactions_payments.type != \'transfer\'\n		AND plugin_bookings_transactions_payments.created >= \"{!From!}\"\n		AND plugin_bookings_transactions_payments.created <= \"{!To!}\"\n	),0)AS \'Returned to Teacher\'\nFROM plugin_bookings_transactions_payments' WHERE `name` = 'Cash Flow';
    select last_insert_id() into @refid_plugin_reports_reports;
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'From', `value` = '01-08-2015', `delete` = '0';
	insert into `plugin_reports_parameters` set `report_id` = @refid_plugin_reports_reports, `type` = 'date', `name` = 'To', `value` = '31-08-2015', `delete` = '0';

UPDATE IGNORE `plugin_reports_reports` set `sql` = 'SELECT\n	CONCAT(l1.`name`, \' - \', l.`name`)AS `Name`,\n	l.capacity AS `Room Capacity`,\n	s2.max_capacity AS `Schedule Capacity`,\nCOALESCE(\n    (\n      SELECT \n        COUNT(b.attending) \n      FROM \n        plugin_ib_educate_booking_items `b` \n        INNER JOIN plugin_courses_schedules_events `s` ON b.period_id = s.id \n        INNER JOIN plugin_courses_schedules `s1` ON s.schedule_id = s1.id \n      WHERE \n        b.attending = 1 \n        AND s.datetime_start = CURDATE() \n        AND s1.location_id = l.id\n    ), \n    0\n  ) AS `Attending`,\n	l.capacity - COALESCE(\n		(\n			SELECT\n				COUNT(b.attending)\n			FROM\n				plugin_ib_educate_booking_items `b`\n			INNER JOIN plugin_courses_schedules_events `s` ON b.period_id = s.id\n			INNER JOIN plugin_courses_schedules `s1` ON s.schedule_id = s1.id\n			WHERE\n				b.attending = 1\n			AND s.datetime_start = CURDATE()\n			AND s1.location_id = l.id\n		),\n		0\n	)AS `Free Space`\nFROM\n	plugin_courses_locations `l`\nJOIN plugin_courses_locations `l1` ON l.parent_id = l1.id\nINNER JOIN plugin_courses_schedules `s2` ON s2.location_id = l.id \nWHERE\n	l.`delete` = 0\nORDER BY\n	NAME' WHERE `name` = 'Free Rooms';

-- KES-436
   -- fix a wrong join
   UPDATE plugin_reports_reports SET `sql` = REPLACE(`sql`, 'plugin_courses_schedules_events c4 ON c1.id = c4.id', 'plugin_courses_schedules_events c4 ON c1.id = c4.schedule_id') WHERE `sql` LIKE '%plugin_courses_schedules_events c4 ON c1.id = c4.id%';
