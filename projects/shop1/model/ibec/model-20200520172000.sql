/*
ts:2020-05-20 17:20:00
*/

UPDATE `plugin_reports_reports` SET `sql`='SELECT \r\n    `b`.`booking_id` AS `Booking ID`, \r\n    `bs`.`title`     AS `Booking Status`, \r\n    CONCAT(`c`.`first_name`, \' \' ,`c`.`last_name`) AS `Booking Name`, \r\n    `tt`.`type`      AS `Booking Type`, \r\n    `courses`.`title` AS `Course Name`,\r\n    `s`.`name`       AS `Schedule Name`, \r\n     `s`.`start_date` AS `Start Date`,\r\n    `t`.`updated`    AS `Cancelled Date`, \r\n    `t`.`amount`     AS `Transaction Amount` ,\r\n		`navapi_events`.`remote_event_no`  as `Nav Event code`,\r\n    GROUP_CONCAT(CONCAT_WS(\' \',delagate_students.first_name, delagate_students.last_name)) AS `Cancelled Delegates`\r\n\r\nFROM       `plugin_ib_educate_bookings` `b` \r\nINNER JOIN `plugin_ib_educate_booking_has_schedules` `bhs` ON `bhs`.`booking_id`     = `b` .`booking_id` \r\nINNER JOIN `plugin_courses_schedules`                `s`   ON `bhs`.`schedule_id`    = `s` .`id` \r\nINNER JOIN plugin_courses_courses courses ON s.course_id = courses.id\r\nLEFT JOIN plugin_ib_educate_bookings_has_delegates delegates ON b.booking_id = delegates.booking_id\r\nLEFT JOIN plugin_contacts3_contacts delagate_students ON delegates.contact_id=delagate_students.id\r\nLEFT JOIN `plugin_ib_educate_bookings_status`       `bs`  ON `bhs`  .`booking_status` = `bs`.`status_id` \r\nLEFT JOIN `plugin_contacts3_contacts`               `c`   ON `c`  .`id`             = `b` .`contact_id` \r\nLEFT JOIN (select t.*, ths.schedule_id from plugin_bookings_transactions t left join plugin_bookings_transactions_has_schedule ths on t.id = ths.transaction_id) t ON b.booking_id = t.booking_id and t.schedule_id = bhs.schedule_id\r\nLEFT JOIN `plugin_bookings_transactions_types`      `tt`  ON `t`  .`type`           = `tt`.`id` \r\nLEFT JOIN `plugin_navapi_events` as `navapi_events` ON `s`.`id` = `navapi_events`.`schedule_id`\r\nWHERE `bhs`.`booking_status` = 3 \nAND `b`.`modified_date` >= \'{!From!}\' AND `b`.`modified_date` < DATE_ADD(\'{!To!}\', INTERVAL 1 DAY) GROUP BY b.booking_id' WHERE (`name`='Cancelled Bookings');
